Module Tests

    Sub UploadAndDownloadDemo()
        Dim http As New cHttpClient
        Dim uploadPath As String = "C:\Temp\data.txt"
        Dim downloadPath As String = "C:\Temp\downloaded.bin"
        Const downloadText As String = "C:\Temp\downloaded.txt"

        ' ========== Upload File ==========
        Debug.Print "Uploading file..."

        If http.UploadFileSimple("https://httpbin.org/post", uploadPath) Then
            Debug.Print "Upload successful!"

            ' Parse response
            Dim json As cJson
            Set json = http.ReturnJson()
            Debug.Print "Server response: " & json.Encode
        Else
            Debug.Print "Upload failed: " & http.LastError
            Exit Sub
        End If

        ' ========== Download File ==========
        Debug.Print "Downloading file..."

        On Error Resume Next
        http.DownloadFile "https://httpbin.org/bytes/1024", downloadPath

        If Err.Number = 0 Then
            Debug.Print "Download successful! File size: " & FileLen(downloadPath) & " bytes"
        Else
            Debug.Print "Download failed: " & Err.Description
        End If
        On Error GoTo 0
        
        ' ============= Download text ===============
        On Error Resume Next
        http.DownloadFile "https://httpbin.org/encoding/utf8", downloadText

        If Err.Number = 0 Then
            Debug.Print "Download successful! File size: " & FileLen(downloadText) & " bytes"
        Else
            Debug.Print "Download failed: " & Err.Description
        End If
        On Error GoTo 0
        
    End Sub
    
    Sub    TestHttpClient()
        On Error GoTo EH
        With New cHttpClient
            'Make json body
            With .RequestDataJson
                With .NewItem("consignee")
                    With .NewItem("address")
                        .Item("city") = "Paderborn"
                        .Item("countryCode") = "DE"
                        .Item("postCode") = "33100"
                    End With
                End With
                With .NewItems("lines")
                    With .NewItem()
                        .Item("content") = "furniture"
                        .Item("unitHeight") = 120
                        .Item("unitLength") = 120
                        .Item("unitPackageType") = "EP"
                        .Item("unitQuantity") = 1
                        .Item("unitWeight") = 200
                        .Item("unitWidth") = 80
                    End With
                End With
                .Item("product") = "STANDARD"
                With .NewItem("consignee")
                    With .NewItem("address")
                        .Item("city") = "Berlin"
                        .Item("countryCode") = "DE"
                        .Item("postCode") = "10115"
                    End With
                End With
                .Item("pickupOn") = Format$(Now, "yyyy-MM-dd")
                'Check json data
                Debug.Print "Request Data: ",.Encode(, 2, True)
            End With
            'You can open debug info object form build in.
            .DebugStart = True
            'Add any header
            .RequestHeaders.Item("X-API-KEY") = "YOUR API KEY HERE"
            'You can set Content-Type like this:
            .SetRequestContentType(EnumRequestContentType.JsonString)
            'Post 
            .SendPost("https://vb6.pro/echo/?hello=woeoio")
            'Server retun json data
            With .ReturnJson()
                MsgBox(.Root("server")("time"))
                'Show server reopnse, you can use .ReturnText()
                Debug.Print "Server Response: ", .Encode(, 2, True)
            End With
            QH:
            'Show deubg info
            Debug.Print "Debug Info: ", .DebugInfo.Encode(, 2, True)
            Exit Sub
            EH:
            'Do some thing...
            MsgBox(Err.Description)
            Resume QH
        End With
    End Sub

End Module